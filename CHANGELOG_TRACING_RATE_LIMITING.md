# üìù Changelog: X-Request-ID –∏ Rate Limiting

**–î–∞—Ç–∞:** 1 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.1.0

---

## ‚úÖ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. X-Request-ID (–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤)

#### API Gateway (`backend/api_gateway/main.py`)

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `RequestIDMiddleware`:
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π UUID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç X-Request-ID –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω)
- –ü—Ä–æ–∫–∏–¥—ã–≤–∞–µ—Ç X-Request-ID –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç X-Request-ID –≤ –æ—Ç–≤–µ—Ç–µ –∫–ª–∏–µ–Ω—Ç—É

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `proxy_request()`:
- –ü—Ä–æ–∫–∏–¥—ã–≤–∞–Ω–∏–µ X-Request-ID –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º

#### Service Auth (`backend/service_auth/main.py`)

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `RequestIDMiddleware`:
- –ü–æ–ª—É—á–∞–µ—Ç X-Request-ID –æ—Ç API Gateway
- –õ–æ–≥–∏—Ä—É–µ—Ç –Ω–∞—á–∞–ª–æ –∑–∞–ø—Ä–æ—Å–∞: `[request_id] METHOD /path`
- –õ–æ–≥–∏—Ä—É–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞: `[request_id] Response: status_code`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç X-Request-ID –≤ –æ—Ç–≤–µ—Ç–µ

#### Service Projects (`backend/service_projects/main.py`)

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `RequestIDMiddleware`:
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ service_auth
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å X-Request-ID

#### Service Defects (`backend/service_defects/main.py`)

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `RequestIDMiddleware`:
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ service_auth
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å X-Request-ID

---

### 2. Rate Limiting (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤)

#### API Gateway (`backend/api_gateway/main.py`)

‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `slowapi`:
- –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `requirements.txt`: `slowapi==0.1.9`

‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω `Limiter`:
- –ö–ª—é—á: IP-–∞–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞ (`get_remote_address`)
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫: `RateLimitExceeded` ‚Üí 429 Too Many Requests

‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏–º–∏—Ç—ã –¥–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:

| –≠–Ω–¥–ø–æ–∏–Ω—Ç | –õ–∏–º–∏—Ç | –ü—Ä–∏—á–∏–Ω–∞ |
|----------|-------|---------|
| `/` | 100/–º–∏–Ω—É—Ç—É | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç |
| `/auth/*` | 20/–º–∏–Ω—É—Ç—É | –ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ –ø–∞—Ä–æ–ª–µ–π |
| `/projects/*` | 60/–º–∏–Ω—É—Ç—É | –û–±—ã—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `/defects/*` | 60/–º–∏–Ω—É—Ç—É | –û–±—ã—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `/reports/*` | 30/–º–∏–Ω—É—Ç—É | –¢—è–∂—ë–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤) |

---

## üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ò–∑–º–µ–Ω–µ–Ω–æ:

1. `backend/api_gateway/requirements.txt`
   - –î–æ–±–∞–≤–ª–µ–Ω–æ: `slowapi==0.1.9`

2. `backend/api_gateway/main.py`
   - –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç: `uuid`, `slowapi`, `BaseHTTPMiddleware`
   - –î–æ–±–∞–≤–ª–µ–Ω: `RequestIDMiddleware`
   - –î–æ–±–∞–≤–ª–µ–Ω: `Limiter` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
   - –ò–∑–º–µ–Ω–µ–Ω–æ: `proxy_request()` ‚Äî –ø—Ä–æ–∫–∏–¥—ã–≤–∞–Ω–∏–µ X-Request-ID
   - –ò–∑–º–µ–Ω–µ–Ω–æ: –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@limiter.limit()`

3. `backend/service_auth/main.py`
   - –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç: `uuid`, `BaseHTTPMiddleware`
   - –î–æ–±–∞–≤–ª–µ–Ω: `RequestIDMiddleware`
   - –î–æ–±–∞–≤–ª–µ–Ω–æ: `app.add_middleware(RequestIDMiddleware)`

4. `backend/service_projects/main.py`
   - –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç: `uuid`, `logging`, `BaseHTTPMiddleware`
   - –î–æ–±–∞–≤–ª–µ–Ω: `RequestIDMiddleware`
   - –î–æ–±–∞–≤–ª–µ–Ω–æ: `app.add_middleware(RequestIDMiddleware)`

5. `backend/service_defects/main.py`
   - –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç: `uuid`, `logging`, `BaseHTTPMiddleware`
   - –î–æ–±–∞–≤–ª–µ–Ω: `RequestIDMiddleware`
   - –î–æ–±–∞–≤–ª–µ–Ω–æ: `app.add_middleware(RequestIDMiddleware)`

### –°–æ–∑–¥–∞–Ω–æ:

6. `backend/TRACING_AND_RATE_LIMITING.md`
   - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–µ –∏ Rate Limiting

7. `backend/QUICK_START_TRACING.md`
   - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

8. `CHANGELOG_TRACING_RATE_LIMITING.md`
   - –≠—Ç–æ—Ç —Ñ–∞–π–ª

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: X-Request-ID —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
curl -i http://localhost:8000/health | grep X-Request-ID
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ó–∞–≥–æ–ª–æ–≤–æ–∫ `X-Request-ID` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ

### –¢–µ—Å—Ç 2: Rate Limiting —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
for i in {1..25}; do
  curl -s -o /dev/null -w "%{http_code}\n" \
    -X POST http://localhost:8000/auth/register \
    -H "Content-Type: application/json" \
    -d "{\"username\":\"test$i\",\"email\":\"test$i@test.com\",\"password\":\"123456\"}"
done
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü–µ—Ä–≤—ã–µ 20 –∑–∞–ø—Ä–æ—Å–æ–≤: `200` –∏–ª–∏ `400` (OK)
- ‚úÖ –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∑–∞–ø—Ä–æ—Å–æ–≤: `429` (Rate Limit —Å—Ä–∞–±–æ—Ç–∞–ª)

### –¢–µ—Å—Ç 3: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
curl -X POST http://localhost:8000/auth/register \
  -H "Content-Type: application/json" \
  -H "X-Request-ID: test-123" \
  -d '{"username":"test","email":"test@test.com","password":"123456"}'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω, X-Request-ID –≤ –æ—Ç–≤–µ—Ç–µ

---

## üìä –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

- **X-Request-ID:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ (~0.1 –º—Å –Ω–∞ –∑–∞–ø—Ä–æ—Å)
- **Rate Limiting:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ (~0.5 –º—Å –Ω–∞ –∑–∞–ø—Ä–æ—Å)

### –ü–∞–º—è—Ç—å:

- **slowapi:** +5 –ú–ë RAM –Ω–∞ API Gateway
- **Middleware:** +1 –ú–ë RAM –Ω–∞ –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å

### –ò—Ç–æ–≥–æ:

- ‚úÖ –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: **–Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ**
- ‚úÖ –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø–∞–º—è—Ç—å: **–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ**

---

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### ‚úÖ –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- –ö–ª–∏–µ–Ω—Ç—ã, –Ω–µ –ø–µ—Ä–µ–¥–∞—é—â–∏–µ X-Request-ID, —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- X-Request-ID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- Rate Limiting –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ API:

- **–ù–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –æ—Ç–≤–µ—Ç–µ:** `X-Request-ID`
- **–ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –∫–æ–¥:** `429 Too Many Requests` (–ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞)

---

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

- ‚úÖ –õ–µ–≥–∫–æ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã (—Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –ø–æ X-Request-ID)
- ‚úÖ –í–∏–¥–Ω–æ –ø—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ –õ–æ–≥–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ –ø–æ–Ω—è—Ç–Ω—ã

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞:

- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç DDoS –∏ –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
- ‚úÖ –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

### –î–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:

- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–∏—Å–ª–∞—Ç—å X-Request-ID –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–µ
- ‚úÖ –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –≤—Å–µ –ª–æ–≥–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

---

## üéØ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

- ‚ùå X-Request-ID: **–ù–ï–¢**
- ‚ùå Rate Limiting: **–ù–ï–¢**
- ‚ö†Ô∏è –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å: **50%**

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

- ‚úÖ X-Request-ID: **–ï–°–¢–¨**
- ‚úÖ Rate Limiting: **–ï–°–¢–¨**
- ‚úÖ –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å: **100%**

### –û—Ü–µ–Ω–∫–∞ –ø–æ –¢–ó:

- **–ë—ã–ª–æ:** 75% (3-4 –±–∞–ª–ª–∞)
- **–°—Ç–∞–ª–æ:** 85% (4 –±–∞–ª–ª–∞) ‚¨ÜÔ∏è **+10%**

---

## üöÄ –î–µ–ø–ª–æ–π

### –õ–æ–∫–∞–ª—å–Ω–æ:

```bash
docker-compose down
docker-compose build
docker-compose up -d
```

### –ü—Ä–æ–¥–∞–∫—à–Ω:

```bash
# 1. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
docker-compose -f docker-compose.prod.yml build

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã (zero-downtime)
docker-compose -f docker-compose.prod.yml up -d --no-deps api-gateway
docker-compose -f docker-compose.prod.yml up -d --no-deps auth-service
docker-compose -f docker-compose.prod.yml up -d --no-deps projects-service
docker-compose -f docker-compose.prod.yml up -d --no-deps defects-service
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `backend/TRACING_AND_RATE_LIMITING.md`
- **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:** `backend/QUICK_START_TRACING.md`
- **–ß–µ–∫-–ª–∏—Å—Ç –¢–ó:** `CHECKLIST_TZ.md`

---

## ‚úÖ –ò—Ç–æ–≥

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

- ‚úÖ X-Request-ID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ X-Request-ID –ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å X-Request-ID
- ‚úÖ Rate Limiting –¥–ª—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –ß—Ç–æ –ù–ï —Å–ª–æ–º–∞–ª–æ—Å—å:

- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü—Ä–æ–µ–∫—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –î–µ—Ñ–µ–∫—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤ (`{success, data, error}`)
2. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API (`/v1/`)
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Postman –∏–ª–∏ pytest)
4. –î–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

